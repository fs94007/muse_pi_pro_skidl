# K1 SoC 符号定义 - 快速开始指南

## 概述

本项目为 K1 SoC 自动生成了 SKiDL 和 KiCad 符号定义文件。K1 SoC 采用 676-pin BGA 封装，包含丰富的外设接口。

## 生成的文件

| 文件名 | 说明 |
|--------|------|
| `k1_soc_symbol.py` | SKiDL Python 组件定义 |
| `k1_soc.kicad_sym` | KiCad 符号库文件 |
| `pin_classification.txt` | 引脚分类详细报告 |
| `generate_symbols.py` | 符号生成脚本 |
| `README.md` | 英文文档 |
| `VALIDATION_REPORT.md` | 验证报告 |

## 引脚统计

- **总引脚数：** 676
- **已分类：** 676 (100%)
- **功能分组：** 19 个类别

### 主要接口分布

| 接口类型 | 引脚数 | 说明 |
|----------|--------|------|
| 地线 | 159 | VSS、AVSS 等 |
| DDR/LPDDR | 141 | LPDDR4X/LPDDR3 内存接口 |
| GPIO | 107 | 通用 I/O (GPIO_00~GPIO_127) |
| 电源 | 74 | VCC、AVDD 等 |
| MIPI CSI | 33 | 摄像头接口 |
| eMMC | 24 | 存储接口 |
| MIPI DSI | 21 | 显示接口 |
| USB | 18 | USB 2.0 接口 (3组) |
| 音频 | 13 | 音频编解码器接口 |
| PCIe | 27 | PCIe 接口 (A/B/C 三组) |
| SD/MMC1 | 8 | SD 卡接口 |
| QSPI | 8 | QSPI Flash 接口 |
| 电源管理 | 7 | PMIC、复位、睡眠控制 |
| JTAG | 6 | 调试接口 |
| 时钟参考 | 6 | 晶振、参考时钟 |

## 使用方法

### 方式一：SKiDL (Python 原理图设计)

#### 1. 安装 SKiDL

```bash
pip install skidl
```

#### 2. 导入并使用

```python
from skidl import Net
from k1_soc_symbol import K1_SoC

# 创建 K1 SoC 实例
k1 = K1_SoC()

# 创建电源网络
vcc_0v9 = Net('VCC_0V9')
vcc_1v8 = Net('VCC_1V8')
gnd = Net('GND')

# 连接核心电源
k1['VCC_M1'] += vcc_0v9

# 连接地
k1['VSS'] += gnd

# 连接 GPIO
gpio_led = Net('LED_CTRL')
k1['GPIO_00'] += gpio_led

# 连接 UART
uart_tx = Net('UART_TX')
uart_rx = Net('UART_RX')
k1['GPIO_01'] += uart_tx
k1['GPIO_02'] += uart_rx

# 连接 eMMC
k1['EMMC_CLK'] += Net('EMMC_CLK')
k1['EMMC_CMD'] += Net('EMMC_CMD')
for i in range(8):
    k1[f'EMMC_D{i}'] += Net(f'EMMC_D{i}')
```

### 方式二：KiCad (图形化原理图设计)

#### 1. 添加符号库

1. 打开 KiCad
2. 选择 **首选项 → 管理符号库**
3. 点击 **添加**，选择 `k1_soc.kicad_sym`
4. 设置库名称（如 "K1_SoC"）

#### 2. 使用符号

1. 在原理图编辑器中按 `A` 添加元件
2. 搜索 "K1_SoC"
3. 放置到原理图中
4. 连接所需引脚

#### 3. 推荐做法

- **分层设计：** 为主要接口创建子页（DDR、PCIe、USB 等）
- **电源符号：** 使用多个电源符号以提高可读性
- **网络标签：** 对重要信号使用网络标签
- **参考文档：** 查看 `pin_classification.txt` 了解引脚分组

## 主要接口说明

### 1. DDR/LPDDR 内存接口 (141 pins)

支持 LPDDR4X (0.6V I/O) 和 LPDDR3 (1.2V I/O)

**主要引脚：**
- 数据线：DQ_A[0:15], DQ_B[0:15]
- 数据选通：DQS0/1_T/C_A/B
- 命令地址：CA_A[0:5], CA_B[0:5]
- 时钟：CK_T/C_A/B
- 片选：CS0/1_A/B
- 电源：VDDQ_V1P2, AVDD06_DDR, AVDD11_DDR

### 2. GPIO (107 pins)

通用 I/O，支持 1.8V 或 1.8V/3.3V

**引脚：** GPIO_00 到 GPIO_127  
**电源：** VCC18_GPIO, VCC1833_GPIO2/3

### 3. MIPI CSI 摄像头接口 (33 pins)

- CSI1：4 通道
- CSI2：时钟通道（CSI3 双模式配置时使用）
- CSI3：4 通道（可配置为 4 通道或双 2 通道）

### 4. MIPI DSI 显示接口 (21 pins)

- DSI1：4 通道

### 5. PCIe 接口 (27 pins)

- PCIEA：1 通道
- PCIEB：2 通道
- PCIEC：2 通道

### 6. USB 2.0 (18 pins)

- USB0：D+/D- 差分对
- USB1：D+/D- 差分对
- USB2：D+/D- 差分对

### 7. 存储接口

#### eMMC (24 pins)
- 8-bit 数据 + 时钟 + 命令 + DS

#### SD/MMC1 (8 pins)
- 4-bit 数据 + 时钟 + 命令

### 8. QSPI Flash (8 pins)

- 4-bit 数据 + 时钟 + 片选

### 9. HDMI (15 pins)

- 3 个数据通道（差分）
- 1 个时钟通道（差分）

### 10. 电源管理 (7 pins)

- PMIC I²C：PWR_SCL, PWR_SDA
- 复位：RESET_IN_N
- 睡眠：SLEEP_OUT
- 动态电压：DVL0, DVL1
- 中断：PMIC_INT_N

### 11. JTAG 调试 (6 pins)

- PRI_TCK：时钟
- PRI_TDO：数据输出
- PRI_TDI：数据输入
- PRI_TMS：模式选择
- PRI_TRST_N：复位
- JTAG_SEL：选择

## 电源要求

K1 SoC 需要多个电源域：

| 电源轨 | 电压 | 说明 |
|--------|------|------|
| VCC_M1 | 0.9V | 数字核心电源 |
| VCC18_GPIO | 1.8V | GPIO 电源 |
| VCC1833_GPIO | 1.8V/3.3V | 可配置 GPIO 电源 |
| VDDQ_V1P2 | 0.6V/1.2V | DDR I/O 电源 |
| AVDD06_DDR | 0.6V | DDR 模拟电源 (LPDDR4X) |
| AVDD11_DDR | 1.1V | DDR PHY 电源 |
| AVDD18_* | 1.8V | 各种 1.8V 模拟电源 |
| AVDD09_* | 0.9V | 各种 0.9V 数字电源 |
| AVDD33_* | 3.3V | 各种 3.3V 电源 |

## 重新生成符号

如果 CSV 文件有更新，可以重新生成所有符号文件：

```bash
python3 generate_symbols.py
```

这将更新：
- k1_soc_symbol.py
- k1_soc.kicad_sym
- pin_classification.txt

## 验证状态

✓ 所有 676 个引脚已解析  
✓ 所有引脚已分类到功能组  
✓ 无重复或遗漏的引脚  
✓ 引脚类型正确映射  
✓ SKiDL 符号已生成  
✓ KiCad 符号已生成  
✓ 分类报告已生成  

详细验证信息请参阅 `VALIDATION_REPORT.md`

## 设计建议

### 硬件设计注意事项

1. **电源时序：** 注意多电源域的上电顺序
2. **去耦电容：** 每个电源域需要适当的去耦电容
3. **阻抗匹配：** 高速接口（DDR、PCIe、USB、HDMI）需要阻抗匹配
4. **差分对布线：** LVDS/MIPI 接口使用差分对布线
5. **参考文档：** 查看 K1 SoC 数据手册了解电气规格

### 原理图设计建议

1. **模块化：** 使用分层设计，将主要接口分到不同页面
2. **命名规范：** 使用清晰的网络名称
3. **电源标注：** 明确标注每个电源域的电压
4. **文档完整：** 在原理图中添加必要的注释和说明
5. **审查检查：** 使用 ERC 工具检查电气规则

## 参考文档

- `README.md` - 详细的英文文档
- `pin_classification.txt` - 引脚分类详细列表
- `VALIDATION_REPORT.md` - 完整的验证报告
- `soc_k1_pins.csv` - 原始引脚数据

## 技术支持

如有问题或建议，请参考 K1 SoC 官方文档或在仓库中创建 issue。

---

**生成日期：** 自动生成  
**数据来源：** soc_k1_pins.csv  
**状态：** ✓ 已验证
